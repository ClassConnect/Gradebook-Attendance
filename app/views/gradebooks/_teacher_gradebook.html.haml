:javascript
  $(document).ready(function() {
      //START OTHER STUFF
      add_new_input();
      init_assignments_array(#{@assignments.to_json :only => [:_id, :point_value]});
      init_gradescale(#{@settings.grade_scale.grade_ranges.asc(:from).to_json :except => [:_id]});
      
      /*
      $('.datatable tbody tr').each(function(){
        calculateGrade(this);
      });
      */
      
      //initTable(#{@students.count});

      //init_keytable();
      
    initTable(#{@students.count});
    $('.dataTables_scrollBody .datatable').attr('style', "");
    $('.assignment_head .datatable').attr('style', "");
    $('.datatable .DTFC_Cloned').attr('style', "");
    //This is a dumb way to do it, but when we go back for performance, we can fix it

    $('.dataTables_scrollBody .datatable tbody tr').each(function(){
      calculateGrade(this);
    });

    $('#add_assignment_button').click(function(){
      openBox('/gradebooks/#{@course.id}/assignments', 350);
    });

    $('#edit_scale_button').click(function(){
      openBox('/gradebooks/grading_scale/#{@course.id}', 350);
    });

    $('.testclass').mouseover(function(){
      console.log("hi");
    });

    
    /*
    var popup_content;
    $("img").tooltip({
      onBeforeShow: function(){
        var assignment_id = this.getTrigger().parent().attr('id');
        var url_string = '/assignments/' + assignment_id; 
        $.ajax({
          type: 'GET',
          async: false,
          url: url_string,
          dataType: "html",
          success: function(data){
            popup_content = data;
          }
        });
      },
      onShow: function(){
          $('.tooltip').html(popup_content);
        }
    });
    */

    $(".hover_button").not('.tt_init').tooltip(jeditable_dictionary);
    $(".hover_button").not('.tt_init').addClass('tt_init');


  }); 

%h1="DES"
%input{:type => "button", :value => "Add Assignment", :class => "button", :id => "add_assignment_button"}
%input{:type => "button", :value => "Edit Scale", :class => "button", :id => "edit_scale_button"}
%div{:id => "gradebook_div"}
  %table{:id => "gradebook_display", :class=> "datatable", :width => "#{@assignments.count * 150}px"}
    %thead
      %tr{:class => "header_row"}
        %th{:width => 110} First Name
        %th{:width => 110} Last Name
        %th{:width => 50} Grade
        -i=3
        %span{:id => "assignment_names"}
          -@assignments.each do |assignment|
            %th{:class => "assignment_header", :col => i, :value => assignment.point_value, :id => "#{assignment.id}"}
              =assignment.name
              =image_tag("exclm.png", {:class => "hover_button", :align => "right", :title => "hi"})
              -i += 1

    %tbody{:grading_scale => GradebooksController::DEFAULT_SCALE.to_json, :assignment_data => (@assignments.to_json :only => [:_id, :assignment_type_id]), :cols => i, :students => (students_to_attr(@students))}
      -@students.each do |student|
        -i=0
        -if student.is_student?
          -id_string = student.id.to_s
          %tr{:class => "row_entry", :id => "#{student.id}"}
            %td{:width => 110}=student.first_name.capitalize
            %td{:width => 110}=student.last_name.capitalize
            %td{:width => 50}="" 
            -@assignments.each do |assignment|
              -if current_assignment = assignment.grades[id_string]
                -if assignment.grades[id_string][0] != :ungraded
                  %td{:align => "center", :class => "grade_entry", :score => assignment.grades[id_string][0]}=assignment.grades[id_string][0]
                -else
                  %td{:align => "center", :class => "grade_entry"}=""
              -else
                %td{:align => "center", :class => "grade_entry"}=""
              -i+=1

%div{:id => "dialogBox"}
%div{:id => "blackbox"}
%div{:id => "clearbox"}
